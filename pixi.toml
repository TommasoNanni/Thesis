[workspace]
channels = ["conda-forge", "nvidia"]
platforms = ["linux-64"]
name = "ghost"

[system-requirements]
cuda = "12.6"

[dependencies]
python = "3.12.*"
# pymomentum from conda-forge; it will pull in a CPU pytorch as its conda dep.
# The actual CUDA pytorch is installed afterwards via the `setup-cuda` task.
pymomentum = ">=0.1.90"
pip = "*"
numpy = ">=1.24.4"
tqdm = ">=4.66.1"
pillow = ">=9.4.0"
scikit-learn = ">=1.8.0,<2"
pyyaml = ">=6.0.3,<7"

[pypi-options]
# SAM-2 and groundingdino import torch at build time; build them inside the
# conda env (where conda's torch is already present) rather than in isolation.
no-build-isolation = ["groundingdino", "SAM-2", "detectron2"]
dependency-overrides = { iopath = ">=0.1.7" }

[pypi-dependencies]
"SAM-2" = {path = "Grounded-SAM-2", editable = true}
groundingdino = {path = "Grounded-SAM-2/grounding_dino", editable = true}
mhr = { path = "MHR", editable = true }
sam-3d-body = { path = "sam-3d-body", editable = true }
detectron2 = { git = "https://github.com/facebookresearch/detectron2.git", rev = "a1ce2f9" }
moge = { git = "https://github.com/microsoft/MoGe.git" }
transformers = ">=4.0"
addict = "*"
yapf = "*"
timm = ">=1.0.24, <2"
opencv-python = ">=4.13.0.92, <5"
supervision = ">=0.22.0"
pycocotools = ">=2.0.11, <3"
hydra-core = ">=1.3.2, <2"
iopath = ">=0.1.7"
decord = ">=0.6.0, <0.7"
smplx = ">=0.1.28, <0.2"
pytorch-lightning = ">=2.6.1, <3"
pyrender = ">=0.1.45, <0.2"
yacs = ">=0.1.8, <0.2"
scikit-image = ">=0.26.0, <0.27"
einops = ">=0.8.2, <0.9"
dill = ">=0.4.1, <0.5"
pandas = ">=3.0.1, <4"
rich = ">=14.3.2, <15"
pyrootutils = ">=1.0.4, <2"
webdataset = ">=1.0.2, <2"
roma = ">=1.5.6, <2"
joblib = "*"
seaborn = ">=0.13.2, <0.14"
wandb = ">=0.25.0, <0.26"
fvcore = ">=0.1.5.post20221221, <0.2"
tensorboard = ">=2.20.0, <3"
huggingface-hub = ">=1.4.1, <2"
loguru = ">=0.7.3, <0.8"
optree = "*"
hatchling = ">=1.28.0, <2"

[tasks]
# Replaces the conda CPU-only torch with a CUDA 12.6 build from PyTorch's index.
# Run this once after `pixi install`: pixi run setup-cuda
# Installs the CUDA 12.6 build of the SAME torch version that pymomentum depends on
# (currently 2.7.1). Same version = ABI-compatible, so pymomentum keeps working.
setup-cuda = "python -m pip install --force-reinstall 'torch==2.7.1+cu128' 'torchvision==0.22.1+cu128' --index-url https://download.pytorch.org/whl/cu128"
